.row {
  display: flex;
  gap: 8px;
  margin: 16px 0 20px;
}

.row input {
  flex: 1;
  padding: 12px 14px;
  border: 1px solid #ddd;
  border-radius: 10px;
}

.row button {
  padding: 12px 14px;
  border: 0;
  border-radius: 10px;
  cursor: pointer;
  background: #222;
  color: #fff;
}

.list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.todo {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 0;
  border-bottom: 1px solid #eee;
}

.toggle {
  background: transparent;
  color: #111;
  padding: 6px 10px;
  border: 1px solid #ddd;
  border-radius: 10px;
  cursor: pointer;
}

.done {
  text-decoration: line-through;
  opacity: 0.6;
}

.muted {
  margin-top: 16px;
  color: #777;
  font-size: 13px;
}
const listEl = document.getElementById("todo-list");
const formEl = document.getElementById("todo-form");
const inputEl = document.getElementById("todo-input");
const filterBtns = document.querySelectorAll(".filter-btn");

let currentFilter = "all";

async function fetchTodos() {
  const res = await fetch(`/api/todos?filter=${currentFilter}`);
  const todos = await res.json();
  render(todos);
}

function setActiveFilterUI() {
  filterBtns.forEach((b) => {
    b.classList.toggle("active", b.dataset.filter === currentFilter);
  });
}

function render(todos) {
  listEl.innerHTML = "";

  for (const t of todos) {
    const li = document.createElement("li");
    li.className = "todo";

    const left = document.createElement("div");
    left.className = "left";

    const toggleBtn = document.createElement("button");
    toggleBtn.type = "button";
    toggleBtn.className = "toggle";
    toggleBtn.textContent = t.done ? "✅" : "⬜";
    toggleBtn.addEventListener("click", async () => {
      await toggleTodo(t.id);
      await fetchTodos();
    });

    const span = document.createElement("span");
    span.textContent = t.title;
    span.className = t.done ? "done" : "";

    left.appendChild(toggleBtn);
    left.appendChild(span);

    const delBtn = document.createElement("button");
    delBtn.type = "button";
    delBtn.className = "delete";
    delBtn.textContent = "삭제";
    delBtn.addEventListener("click", async () => {
      const ok = confirm("삭제할까?");
      if (!ok) return;
      await deleteTodo(t.id);
      await fetchTodos();
    });

    li.appendChild(left);
    li.appendChild(delBtn);
    listEl.appendChild(li);
  }
}

async function addTodo(title) {
  const res = await fetch("/api/todos", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title }),
  });

  if (!res.ok) {
    const err = await res.json().catch(() => ({}));
    alert(err.error || "추가 실패");
    return;
  }

  inputEl.value = "";
  await fetchTodos();
}

async function toggleTodo(id) {
  const res = await fetch(`/api/todos/${id}`, { method: "PATCH" });
  if (!res.ok) alert("토글 실패");
}

async function deleteTodo(id) {
  const res = await fetch(`/api/todos/${id}`, { method: "DELETE" });
  if (!res.ok) alert("삭제 실패");
}

formEl.addEventListener("submit", (e) => {
  e.preventDefault();
  const title = inputEl.value.trim();
  if (!title) return;
  addTodo(title);
});

filterBtns.forEach((b) => {
  b.addEventListener("click", async () => {
    currentFilter = b.dataset.filter;
    setActiveFilterUI();
    await fetchTodos();
  });
});

setActiveFilterUI();
fetchTodos();

.error {
  margin: 10px 0;
  padding: 10px 12px;
  border: 1px solid #f1b4b4;
  background: #fff5f5;
  border-radius: 10px;
}
.auth-form {
  display: grid;
  gap: 10px;
  margin: 16px 0 10px;
}

.auth-form input {
  width: 100%;
  padding: 12px 14px;
  border: 1px solid #ddd;
  border-radius: 10px;
}

.auth-form button {
  padding: 12px 14px;
  border: 0;
  border-radius: 10px;
  cursor: pointer;
  background: #222;
  color: #fff;
}

.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin: 10px 0 14px;
}

.who {
  color: #444;
  font-weight: 600;
}

.logout {
  padding: 10px 12px;
  border: 1px solid #ddd;
  background: #fff;
  border-radius: 10px;
  cursor: pointer;
}
